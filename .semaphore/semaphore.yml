version: v1.0
name: Semaphore
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Depencies
    dependencies: []
    task:
      jobs:
        - name: depencies
          commands:
            - checkout
            - npm i
      epilogue:
        on_pass:
          commands:
            - cache store
  - name: Deploy
    dependencies:
      - Build
    task:
      jobs:
        - name: deploy
          commands:
            - cache restore
            - ls -l
            - >-
              lftp -c "open -u $FTP_USER,$FTP_PASSWORD $FTP_HOST; set
              ssl:verify-certificate no; mirror -R ./dist ./semaphore"
      env_vars:
        - name: FTP_USER
          value: mozprodez_improsoft
        - name: FTP_PASSWORD
          value: Cv8QgwxRrtALuBE
        - name: FTP_HOST
          value: magic-health.su
  - name: Build
    dependencies:
      - Depencies
    task:
      jobs:
        - name: build
          commands:
            - checkout
            - npm run build
            - ls -l
            - cash store dist
      prologue:
        commands:
          - cache restore
