version: v1.0
name: Semaphore
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Depencies
    dependencies: []
    task:
      jobs:
        - name: Depencies
          commands:
            - checkout
            - npm i
      epilogue:
        on_pass:
          commands:
            - cache store
  - name: Deploy
    dependencies:
      - Depencies
    task:
      jobs:
        - name: deploy
          commands:
            - >-
              ls -l - checkout - ls -l - cache restore - ls -l - >- lftp -c
              "open -u $FTP_USER,$FTP_PASSWORD $FTP_HOST; set
              ssl:verify-certificate no; mirror -R ./public ./semaphore"
      env_vars:
        - name: FTP_USER
          value: mozprodez_improsoft
        - name: FTP_PASSWORD
          value: Cv8QgwxRrtALuBE
        - name: FTP_HOST
          value: magic-health.su
